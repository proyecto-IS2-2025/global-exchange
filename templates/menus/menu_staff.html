{# Menu para staff - Basado en permisos #}

<h2 class="h4 mb-4 text-center">Panel de {{ tipo_usuario }}</h2>
<p class="text-muted text-center">Gestiona el sistema desde las opciones de abajo.</p>

<div class="row row-cols-2 row-cols-md-4 g-4 mt-4 justify-content-center">
  
  {# ✅ CORREGIDO: Ver Clientes - Requiere AL MENOS UNO de los permisos #}
  {% if perms.clientes.view_all_clientes or perms.clientes.view_assigned_clientes %}
  <div class="col">
    <div class="card opcion_admin text-center border-0 rounded-4 h-100 p-4">
      <div class="display-3 mb-3"><i class="fas fa-users"></i></div>
      <h6 class="fw-bold">Ver Clientes</h6>
      <a href="{% url 'clientes:lista_clientes' %}" class="stretched-link"></a>
    </div>
  </div>
  {% endif %}
  
  {# Asignar Cliente - Solo admin #}
  {% if perms.clientes.manage_cliente_assignment %}
  <div class="col">
    <div class="card opcion_admin text-center border-0 rounded-4 h-100 p-4">
      <div class="display-3 mb-3"><i class="fas fa-user-friends"></i></div>
      <h6 class="fw-bold">Asignar Cliente</h6>
      <a href="{% url 'clientes:asociar_clientes_usuarios' %}" class="stretched-link"></a>
    </div>
  </div>
  {% endif %}
  
  {# Roles - Solo superuser #}
  {% if user.is_superuser %}
  <div class="col">
    <div class="card opcion_admin text-center border-0 rounded-4 h-100 p-4">
      <div class="display-3 mb-3"><i class="fas fa-shield-alt"></i></div>
      <h6 class="fw-bold">Roles</h6>
      <a href="{% url 'group_list' %}" class="stretched-link"></a>
    </div>
  </div>
  {% endif %}
  
  {# Medios de Cobro - Solo admin #}
  {% if perms.medios_pago.manage_catalogo_medios_pago %}
  <div class="col">
    <div class="card opcion_admin text-center border-0 rounded-4 h-100 p-4">
      <div class="display-3 mb-3"><i class="fas fa-credit-card"></i></div>
      <h6 class="fw-bold">Medios de Cobro</h6>
      <a href="{% url 'medios_pago:lista' %}" class="stretched-link"></a>
    </div>
  </div>
  {% endif %}
  
  {# Divisas - Admin y Operador #}
  {% if perms.divisas.view_divisa %}
  <div class="col">
    <div class="card opcion_admin text-center border-0 rounded-4 h-100 p-4">
      <div class="display-3 mb-3"><i class="fas fa-coins"></i></div>
      <h6 class="fw-bold">Divisas</h6>
      <a href="{% url 'divisas:lista' %}" class="stretched-link"></a>
    </div>
  </div>
  {% endif %}
  
  {# Tasas - Solo admin #}
  {% if perms.divisas.manage_cotizaciones_segmento %}
  <div class="col">
    <div class="card opcion_admin text-center border-0 rounded-4 h-100 p-4">
      <div class="display-3 mb-3"><i class="fas fa-rocket"></i></div>
      <h6 class="fw-bold">Tasas</h6>
      <a href="{% url 'divisas:visualizador_tasas_admin' %}" class="stretched-link"></a>
    </div>
  </div>
  {% endif %}
  
  {# Historial - Admin y Operador (con lógica diferente) #}
  {% if perms.transacciones.view_transacciones_globales or perms.transacciones.view_transacciones_asignadas %}
  <div class="col">
    <div class="card opcion_admin text-center border-0 rounded-4 h-100 p-4">
      <div class="display-3 mb-3"><i class="fas fa-arrows-rotate"></i></div>
      <h6 class="fw-bold">Historial</h6>
      <a href="{% url 'transacciones:historial_admin' %}" class="stretched-link"></a>
    </div>
  </div>
  {% endif %}
  
  {# Límites - Solo admin #}
  {% if perms.clientes.view_limites_operacion %}
  <div class="col">
    <div class="card opcion_admin text-center border-0 rounded-4 h-100 p-4">
      <div class="display-3 mb-3"><i class="fas fa-chart-line"></i></div>
      <h6 class="fw-bold">Límites</h6>
      <a href="{% url 'clientes:panel_limites' %}" class="stretched-link"></a>
    </div>
  </div>
  {% endif %}
  
</div>

{# ✅ MEJORADO: Mensaje más específico #}
{% if not perms.clientes.view_all_clientes and not perms.clientes.view_assigned_clientes and not perms.divisas.view_divisa %}
<div class="alert alert-warning mt-4 text-center">
  <i class="fas fa-exclamation-triangle me-2"></i>
  <strong>Sin permisos asignados</strong>
  <p class="mb-0 mt-2">Tu cuenta aún no tiene permisos configurados. Contacta al administrador del sistema.</p>
</div>
{% endif %}